---
title: Session handling
summary: Starting and handling decoding sessions. 

---

# Session handling

Starting and handling decoding sessions. 

## Functions

|                | Name           |
| -------------- | -------------- |
| [OTD_API](Files/a00258.md#define-otd-api) int | **[otd_session_new](Modules/a00088.md#function-otd-session-new)**(struct [otd_session](Classes/a00165.md) ** sess)<br>Create a decoding session.  |
| [OTD_API](Files/a00258.md#define-otd-api) int | **[otd_session_start](Modules/a00088.md#function-otd-session-start)**(struct [otd_session](Classes/a00165.md) * sess)<br>Start a decoding session.  |
| int | **[otd_inst_send_meta](Modules/a00088.md#function-otd-inst-send-meta)**(struct [otd_decoder_inst](Classes/a00113.md) * di, int key, GVariant * data) |
| [OTD_API](Files/a00258.md#define-otd-api) int | **[otd_session_metadata_set](Modules/a00088.md#function-otd-session-metadata-set)**(struct [otd_session](Classes/a00165.md) * sess, int key, GVariant * data)<br>Set a metadata configuration key in a session.  |
| [OTD_API](Files/a00258.md#define-otd-api) int | **[otd_session_send](Modules/a00088.md#function-otd-session-send)**(struct [otd_session](Classes/a00165.md) * sess, uint64_t abs_start_samplenum, uint64_t abs_end_samplenum, const uint8_t * inbuf, uint64_t inbuflen, uint64_t unitsize)<br>Send a chunk of logic sample data to a running decoder session.  |
| [OTD_API](Files/a00258.md#define-otd-api) int | **[otd_session_send_eof](Modules/a00088.md#function-otd-session-send-eof)**(struct [otd_session](Classes/a00165.md) * sess)<br>Communicate the end of the stream of sample data to the session.  |
| [OTD_API](Files/a00258.md#define-otd-api) int | **[otd_session_terminate_reset](Modules/a00088.md#function-otd-session-terminate-reset)**(struct [otd_session](Classes/a00165.md) * sess)<br>Terminate currently executing decoders in a session, reset internal state.  |
| [OTD_API](Files/a00258.md#define-otd-api) int | **[otd_session_destroy](Modules/a00088.md#function-otd-session-destroy)**(struct [otd_session](Classes/a00165.md) * sess)<br>Destroy a decoding session.  |
| [OTD_API](Files/a00258.md#define-otd-api) int | **[otd_pd_output_callback_add](Modules/a00088.md#function-otd-pd-output-callback-add)**(struct [otd_session](Classes/a00165.md) * sess, int output_type, [otd_pd_output_callback](Files/a00258.md#typedef-otd-pd-output-callback) cb, void * cb_data)<br>Register/add a decoder output callback function.  |


## Functions Documentation

### function otd_session_new

```
OTD_API int otd_session_new(
    struct otd_session ** sess
)
```

Create a decoding session. 

**Parameters**: 

  * **sess** A pointer which will hold a pointer to a newly initialized session on return. Must not be NULL.


**Return**: OTD_OK upon success, a (negative) error code otherwise.

**Since**: 0.3.0 

A session holds all decoder instances, their stack relationships and output callbacks.


### function otd_session_start

```
OTD_API int otd_session_start(
    struct otd_session * sess
)
```

Start a decoding session. 

**Parameters**: 

  * **sess** The session to start. Must not be NULL.


**Return**: OTD_OK upon success, a (negative) error code otherwise.

**Since**: 0.3.0 

Decoders, instances and stack must have been prepared beforehand, and all OTD_CONF parameters set.


### function otd_inst_send_meta

```
static int otd_inst_send_meta(
    struct otd_decoder_inst * di,
    int key,
    GVariant * data
)
```


### function otd_session_metadata_set

```
OTD_API int otd_session_metadata_set(
    struct otd_session * sess,
    int key,
    GVariant * data
)
```

Set a metadata configuration key in a session. 

**Parameters**: 

  * **sess** The session to configure. Must not be NULL. 
  * **key** The configuration key (OTD_CONF_*). 
  * **data** The new value for the key, as a GVariant with GVariantType appropriate to that key. A floating reference can be passed in; its refcount will be sunk and unreferenced after use.


**Return**: OTD_OK upon success, a (negative) error code otherwise.

**Since**: 0.3.0 

### function otd_session_send

```
OTD_API int otd_session_send(
    struct otd_session * sess,
    uint64_t abs_start_samplenum,
    uint64_t abs_end_samplenum,
    const uint8_t * inbuf,
    uint64_t inbuflen,
    uint64_t unitsize
)
```

Send a chunk of logic sample data to a running decoder session. 

**Parameters**: 

  * **sess** The session to use. Must not be NULL. 
  * **abs_start_samplenum** The absolute starting sample number for the buffer's sample set, relative to the start of capture. 
  * **abs_end_samplenum** The absolute ending sample number for the buffer's sample set, relative to the start of capture. 
  * **inbuf** Pointer to sample data. Must not be NULL. 
  * **inbuflen** Length in bytes of the buffer. Must be > 0. 
  * **unitsize** The number of bytes per sample. Must be > 0.


**Return**: OTD_OK upon success, a (negative) error code otherwise.

**Since**: 0.4.0 

If no channel map has been set up, the logic samples must be arranged in channel order, in the least amount of space possible. The default channel set consists of all required channels + all optional channels.

The size of a sample in inbuf is 'unitsize' bytes. If no channel map has been configured, it is the minimum number of bytes needed to store the default channels.

The calls to this function must provide the samples that shall be used by the protocol decoder

* in the correct order ([...]5, 6, 4, 7, 8[...] is a bug),
* starting from sample zero (2, 3, 4, 5, 6[...] is a bug),
* consecutively, with no gaps (0, 1, 2, 4, 5[...] is a bug).
The start- and end-sample numbers are absolute sample numbers (relative to the start of the whole capture/file/stream), i.e. they are not relative sample numbers within the chunk specified by 'inbuf' and 'inbuflen'.

Correct example (4096 samples total, 4 chunks @ 1024 samples each): otd_session_send(s, 0,    1023, inbuf, 1024, 1); otd_session_send(s, 1024, 2047, inbuf, 1024, 1); otd_session_send(s, 2048, 3071, inbuf, 1024, 1); otd_session_send(s, 3072, 4095, inbuf, 1024, 1);

The chunk size ('inbuflen') can be arbitrary and can differ between calls.

Correct example (4096 samples total, 7 chunks @ various samples each): otd_session_send(s, 0,    1023, inbuf, 1024, 1); otd_session_send(s, 1024, 1123, inbuf,  100, 1); otd_session_send(s, 1124, 1423, inbuf,  300, 1); otd_session_send(s, 1424, 1642, inbuf,  219, 1); otd_session_send(s, 1643, 2047, inbuf,  405, 1); otd_session_send(s, 2048, 3071, inbuf, 1024, 1); otd_session_send(s, 3072, 4095, inbuf, 1024, 1);

INCORRECT example (4096 samples total, 4 chunks @ 1024 samples each, but the start- and end-samplenumbers are not absolute): otd_session_send(s, 0,    1023, inbuf, 1024, 1); otd_session_send(s, 0,    1023, inbuf, 1024, 1); otd_session_send(s, 0,    1023, inbuf, 1024, 1); otd_session_send(s, 0,    1023, inbuf, 1024, 1);


### function otd_session_send_eof

```
OTD_API int otd_session_send_eof(
    struct otd_session * sess
)
```

Communicate the end of the stream of sample data to the session. 

**Parameters**: 

  * **sess** The session. Must not be NULL.


**Return**: OTD_OK upon success. A (negative) error code otherwise.

**Since**: 0.6.0 

### function otd_session_terminate_reset

```
OTD_API int otd_session_terminate_reset(
    struct otd_session * sess
)
```

Terminate currently executing decoders in a session, reset internal state. 

**Parameters**: 

  * **sess** The session in which to terminate decoders. Must not be NULL.


**Return**: OTD_OK upon success, a (negative) error code otherwise.

**Since**: 0.5.1 

All decoder instances have their .wait() method terminated, which shall terminate .decode() as well. Afterwards the decoders' optional .reset() method gets executed.

This routine allows callers to abort pending expensive operations, when they are no longer interested in the decoders' results. Note that the decoder state is lost and aborted work cannot resume.

This routine also allows callers to re-use previously created decoder stacks to process new input data which is not related to previously processed input data. This avoids the necessity to re-construct the decoder stack.


### function otd_session_destroy

```
OTD_API int otd_session_destroy(
    struct otd_session * sess
)
```

Destroy a decoding session. 

**Parameters**: 

  * **sess** The session to be destroyed. Must not be NULL.


**Return**: OTD_OK upon success, a (negative) error code otherwise.

**Since**: 0.3.0 

All decoder instances and output callbacks are properly released.


### function otd_pd_output_callback_add

```
OTD_API int otd_pd_output_callback_add(
    struct otd_session * sess,
    int output_type,
    otd_pd_output_callback cb,
    void * cb_data
)
```

Register/add a decoder output callback function. 

**Parameters**: 

  * **sess** The output session in which to register the callback. Must not be NULL. 
  * **output_type** The output type this callback will receive. Only one callback per output type can be registered. 
  * **cb** The function to call. Must not be NULL. 
  * **cb_data** Private data for the callback function. Can be NULL.


**Since**: 0.3.0 

The function will be called when a protocol decoder sends output back to the PD controller (except for Python objects, which only go up the stack).






-------------------------------

Updated on 2025-09-30 at 08:32:12 +0700